<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <style type="text/css">
        .main{
            position: absolute;
            right: 200px;
            bottom: 200px;

        }
    </style>
    <title>迪爱生数据平台</title>
    <!-- ================= Favicon ================== -->
    <!-- Standard -->
    <link rel="shortcut icon" href="http://placehold.it/64.png/000/fff">
    <!-- Retina iPad Touch Icon-->
    <link rel="apple-touch-icon" sizes="144x144" href="http://placehold.it/144.png/000/fff">
    <!-- Retina iPhone Touch Icon-->
    <link rel="apple-touch-icon" sizes="114x114" href="http://placehold.it/114.png/000/fff">
    <!-- Standard iPad Touch Icon-->
    <link rel="apple-touch-icon" sizes="72x72" href="http://placehold.it/72.png/000/fff">
    <!-- Standard iPhone Touch Icon-->
    <link rel="apple-touch-icon" sizes="57x57" href="http://placehold.it/57.png/000/fff">

    <!-- Styles -->
    <!--<link href="../../resources/css/admin/assets/css/lib/font-awesome.min.css" rel="stylesheet">-->
    <!--<link href="../../lib/themify-icons.css" rel="stylesheet">-->
    <link href="../resources/css/lib/data-table/buttons.bootstrap.min.css" rel="stylesheet" />
    <link href="../resources/css/lib/menubar/sidebar.css" rel="stylesheet">
    <link href="../resources/css/lib/bootstrap.min.css" rel="stylesheet">
    <link href="../resources/css/lib/helper.css" rel="stylesheet">
    <link href="../resources/css/style.css" rel="stylesheet">
    <link rel="stylesheet" href="../resources/css/layui.css" media="all">
    <link href="../resources/css/layui.mobile.css" rel="stylesheet">
    <script src="../resources/js/laydate/laydate.js" charset="utf-8"></script>
    <script src="../resources/js/layui.all.js" charset="utf-8"></script>

</head>

<body>
<!-- jquery vendor -->
<script src="http://echarts.baidu.com/gallery/vendors/echarts/echarts-all-3.js" type="text/javascript"></script>
<!--<script src="../../NIIT_Project/web/js/jquery-2.2.4.min.js" type="text/javascript"></script>-->
<script src="../resources/js/lib/jquery.min.js"></script>
<script src="../resources/js/lib/jquery.nanoscroller.min.js"></script>
<!-- nano scroller -->
<script src="../resources/js/lib/menubar/sidebar.js"></script>
<script src="../resources/js/lib/preloader/pace.min.js"></script>
<!-- sidebar -->

<!-- bootstrap -->

<script src="../resources/js/lib/bootstrap.min.js"></script><script src="../resources/js/scripts.js"></script>
<!-- scripit init-->
<script src="../resources/js/lib/data-table/datatables.min.js"></script>
<!--<script src="../resources/js/lib/data-table/buttons.dataTables.min.js"></script>-->
<script src="../resources/js/lib/data-table/dataTables.buttons.min.js"></script>
<script src="../resources/js/lib/data-table/buttons.flash.min.js"></script>
<script src="../resources/js/lib/data-table/jszip.min.js"></script>
<script src="../resources/js/lib/data-table/pdfmake.min.js"></script>
<script src="../resources/js/lib/data-table/vfs_fonts.js"></script>
<script src="../resources/js/lib/data-table/buttons.html5.min.js"></script>
<script src="../resources/js/lib/data-table/buttons.print.min.js"></script>
<script src="../resources/js/lib/data-table/datatables-init.js"></script>


<section>
    <form class="layui-form" style="padding-left: 10%;">
        <fieldset class="layui-elem-field layui-field-title">
            <legend>历史曲线</legend>
        </fieldset>
        <div class="layui-form-item">
            <div class="layui-inline">
                <label for="shebei" class="layui-form-label" style="width: 100px">设备：</label>
                <div class="layui-input-inline">
                    <select name="shebei" id="shebei" lay-verify="required" lay-search="" onchange="onChange2()"  lay-filter="device">
                        <option value="">直接选择或搜索选择</option>
                        <option value ="diaisheng">sda</option>
                        <option value ="saab">Saab</option>
                        <option value="opel">Opel</option>
                        <option value="audi">Audi</option>
                    </select>
                </div>
            </div>
            <div class="layui-inline">
                <label for="congji" class="layui-form-label" style="width: 100px"  lay-filter="point">从机：</label>
                <div class="layui-input-inline">
                    <select name="congji" id="congji" lay-verify="required" lay-search="">
                        <option value="">直接选择或搜索选择</option>
                        <option value="out_water">出水电磁流量计</option>
                        <option value="cod">在线监测</option>
                        <option value="in_water">进水电磁流量计</option>
                        <option value="hate_o">厌氧温度控制</option>
                        <option value="high">高浓排电磁流量计</option>
                    </select>
                </div>
            </div>
            <div class="layui-inline">
                <label for="data" class="layui-form-label" style="width: 100px">数据点：</label>
                <div class="layui-input-inline">
                    <select name="data" id="data" lay-verify="required" lay-search="">
                        <option value="">直接选择或搜索选择</option>
                        <option value ="32442" name="out_tem">出水温度</option>
                        <option value ="30948" name="out_dot">出水累计流量小数</option>
                        <option value="30946" name="out_big">出水累计流量整数</option>
                        <option value="30945" name="moment">出水瞬时流量</option>
                    </select>
                </div>
            </div>

            <br>
            <div class="layui-inline">
                <label for="start_time" class="layui-form-label" style="width: 100px">起始时间：</label>
                <div class="layui-input-inline">
                    <input type="text" class="layui-input" autocomplete="off" id="start_time" name="start_time" placeholder="yyyy-MM-dd HH:mm:ss">
                </div>
            </div>
            <div class="layui-inline">
                <label for="end_time" class="layui-form-label" style="width: 100px">结束时间：</label>
                <div class="layui-input-inline">
                    <input type="text" class="layui-input" autocomplete="off" id="end_time" name="end_time" placeholder="yyyy-MM-dd HH:mm:ss">
                </div>
            </div>
            <button type="button" class="btn btn-success" onclick="query()" style="height: 30px; width: 80px;margin-left: 30px">查  询</button>
            <button type="button" class="btn btn-info" onclick="downLoad()" style="height: 30px; width: 80px;margin-left: 40px">下载数据</button>
            <div id="main" style="height: 70vh;width: 80vw;padding-left: 0.5%;"></div>
        </div>
    </form>
</section>
<script type="text/javascript">
    $(function () {
        document.getElementById("shebei").options.length = 0;
        $.ajax({
            url: '/diaisheng/deviceadmin/getdevice',
            type: 'GET',
            dataType: 'json',
            success: function (data) {
                console.log(data);
                $.each(data.device, function (key, value) {
                    //  console.log(data.deviceID);
                    //console.log(value.deviceId);
                    $("#shebei").append("<option value="+value.deviceId+">"+value.deviceName+"</option>");
                    //$("#shebei").append("<option value="+data.deviceID+">"+data.deviceName+"</option>");
                    console.log("end");
                });
            },
            error:function (err) {
                console.log(err);
            }


        });
        layui.use('form', function () {
            var form = layui.form
                , laydate = layui.laydate;
            form.render();
        });

        layui.use('form', function () {
            var form = layui.form
                , laydate = layui.laydate;
            form.on('select(device)', function (data) {
//        var = $("#shebei").options.length;
                var device = $("#shebei");
                $("#congji").options.length = 0;
                $.ajax({
                    type: "GET",
                    url: "/diaisheng/modeladmin/getdatamodel",
                    data: {"deviceId": shebei},
                    dataType: "json",
                    success: function (data) {
                        $.each(data, function (key, value) {
                            //$("congji").options.add(new Option(value.dataModelName, value.dataModelId));
                            $("#congji").append("<option value="+value.dataModelName+">"+value.dataModelId+"</option>");

                        });
                    },
                    error: function (errorMsg) {
                        alert("数据请求失败");
                    }
                });
            });
        });

        laydate.render({
            elem: '#start_time'
            , type: 'datetime'
        });
        laydate.render({
            elem: '#end_time'
            , type: 'datetime'
        });

        //调取设备

    });



    var myCharts = echarts.init(document.getElementById("main"));
    var option = {
        title: {
            text: 'Line Test',
            subtext: "Mountain Technology"
        },
        tooltip: {
            trigger: 'axis'
        },
        legend: {
            data: '出水量'
//                data:[]
        },
        grid: {
            left: '3%',
            right: '4%',
            bottom: '3%',
            containLabel: true
        },
        xAxis: {
            type: 'category',
            data: ['18:00', '18:20', '18:40', '18:50', '19:00', '19:05', '19:10', '19:20', '19:30', '19:40', '19:50'],

            axisLine: {
                lineStyle: {
//                        color:''
                }
            },
        },
        yAxis: {
            type: 'value'
        },
        dataZoom: [
            {
                type: 'slider',
                xAxisIndex: 0,
                start: 10,
                end: 60
            },
            {
                type: 'inside',
                xAxisIndex: 0,
                start: 10,
                end: 60
            },
            {
                type: 'slider',
                yAxisIndex: 0,
                start: 30,
                end: 80
            },
            {
                type: 'inside',
                yAxisIndex: 0,
                start: 30,
                end: 80
            }
        ],

        series: {
            name: '出水量',
            type: 'line',
            symbolSize: 3,
            color: ['red'],
            data: [1000, 200, 500, 600, 800, 1100, 500, 800, 600, 500, 600],
//                data:[],
            //关键点：实线虚线
            smooth: false,
            itemStyle: {
                normal: {
                    lineStyle: {
                        witdth: 2,
                        type: 'solid'
                    }
                }
            }

        }

    }
    myCharts.setOption(option);

    function query() {
        var myCharts = echarts.init(document.getElementById("main"));
        var option = {
            title: {
                text: 'Line Test',
                subtext: "Mountain Technology"
            },
            tooltip: {
                trigger: 'axis'
            },
            legend: {
                data: '出水量'
//                data:[]
            },
            grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                containLabel: true
            },
            xAxis: {
                type: 'category',
                data: ['18:00', '18:20', '18:40', '18:50', '19:00', '19:05', '19:10', '19:20', '19:30', '19:40', '19:50'],

                axisLine: {
                    lineStyle: {
//                        color:''
                    }
                },
            },
            yAxis: {
                type: 'value'
            },
            dataZoom: [
                {
                    type: 'slider',
                    xAxisIndex: 0,
                    start: 10,
                    end: 60
                },
                {
                    type: 'inside',
                    xAxisIndex: 0,
                    start: 10,
                    end: 60
                },
                {
                    type: 'slider',
                    yAxisIndex: 0,
                    start: 30,
                    end: 80
                },
                {
                    type: 'inside',
                    yAxisIndex: 0,
                    start: 30,
                    end: 80
                }
            ],

            series: {
                name: '出水量',
                type: 'line',
                symbolSize: 3,
                color: ['red'],
                data: [1000, 200, 500, 600, 800, 1100, 500, 800, 600, 500, 600],
//                data:[],
                //关键点：实线虚线
                smooth: true,
                itemStyle: {
                    normal: {
                        lineStyle: {
                            witdth: 2,
                            type: 'solid'
                        }
                    }
                }

            }


        }
        myCharts.setOption(option);
        var shebei = document.getElementById("shebei").value;
        var congji = document.getElementById("congji").value;
        var data = document.getElementById("data").value;
        var stime = document.getElementById("start_time").value;
        var etime = document.getElementById("end_time").value;
        console.log(shebei);
        console.log(congji);
        console.log(data);
        console.log(stime);
        console.log(etime);
        myCharts.showLoading();
        var name = [];
        var series = [];
        $.ajax({
            type: "post",
            url: "/diaisheng/valueadmin/getdatabetweendate",
            data: {"data": data, "stime": stime, "etime": etime},
            dataType: "json",
            success: function (data) {
                $.each(data.dataValue, function (key, value) {
                    console.log(data.dataValue);
                    name.push(value.createTime);
                });
                $.each(data.dataValue, function (key, value) {
                    series.push(value.value);
                });
                myCharts.hideLoading();
                myCharts.setOption({
                    xAxis: {
                        data: name
                    },
                    series: {
                        data: series
                    }
                });

            },
            error: function (errorMsg) {
                //请求失败时执行该函数
                alert("图表请求数据失败!");
                myChart.hideLoading();
            }


        });

    }

    function onChange1() {
        $("#data").options.length = 0;
        var congji = $("#congji");
        $.ajax({
            type: "GET",
            url: "/diaisheng/datapointadmin/getdatapoint",
            data: {"dataModelId": congji},
            dataType: "json",
            success: function (data) {
                $.each(data, function (key, value) {
                    //      $("#data").options.add(new Option(value.dataPointName, value.dataPointID));
                    $("#data").append("<option value="+value.dataPointName+">"+value.dataPointId+"</option>");

                });
            },
            error: function (errorMsg) {
                alert("数据请求失败");
            }
        });
    }


</script>
</body>

</html>