<!DOCTYPE html>
<html>

<head>
    <title>污水智能处理系统</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Free Flat Admin Bootstrap Themes">
    <meta name="author" content="Charuwit Nodthaisong">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link href='../resources/css/indexShow.css' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" type="text/css" href="../resources/css/index/animate.css">
    <link rel="stylesheet" type="text/css" href="../resources/css/index/select2.css">
    <link rel="stylesheet" type="text/css" href="../resources/css/index/style.css">
    <link rel="stylesheet" type="text/css" href="../resources/css/index/theme.css">
    <link href="../resources/css/lib/font-awesome.min.css" rel="stylesheet">
    <link href="../resources/css/lib/themify-icons.css" rel="stylesheet">
    <link href="../resources/css/lib/data-table/buttons.bootstrap.min.css" rel="stylesheet" />
    <link href="../resources/css/lib/menubar/sidebar.css" rel="stylesheet">
    <link href="../resources/css/lib/bootstrap.min.css" rel="stylesheet">
    <link href="../resources/css/lib/helper.css" rel="stylesheet">
    <link href="../resources/css/style.css" rel="stylesheet">

    <!-- jquery vendor -->
    <script src="../resources/js/echarts.js" type="text/javascript"></script>
    <!--<script src="../../NIIT_Project/web/js/jquery-2.2.4.min.js" type="text/javascript"></script>-->
    <script src="../resources/js/lib/jquery.min.js"></script>
    <script src="../resources/js/lib/jquery.nanoscroller.min.js"></script>
    <!-- nano scroller -->
    <script src="../resources/js/lib/menubar/sidebar.js"></script>
    <script src="../resources/js/lib/preloader/pace.min.js"></script>
    <!-- sidebar -->

    <!-- bootstrap -->
    <script src="../resources/js/lib/bootstrap.min.js"></script><script src="../resources/js/scripts.js"></script>
    <!-- scripit init-->
    <script src="../resources/js/lib/data-table/datatables.min.js"></script>
    <!-- <script src="../resources/js/lib/data-table/buttons.dataTables.min.js"></script>-->
    <script src="../resources/js/lib/data-table/dataTables.buttons.min.js"></script>
    <script src="../resources/js/lib/data-table/buttons.flash.min.js"></script>
    <script src="../resources/js/lib/data-table/jszip.min.js"></script>
    <script src="../resources/js/lib/data-table/pdfmake.min.js"></script>
    <script src="../resources/js/lib/data-table/vfs_fonts.js"></script>
    <script src="../resources/js/lib/data-table/buttons.html5.min.js"></script>
    <script src="../resources/js/lib/data-table/buttons.print.min.js"></script>
    <script src="../resources/js/lib/data-table/datatables-init.js"></script>
    <script type="text/javascript" src="../resources/js/Chart.min.js"></script>
    <script type="text/javascript" src="../resources/js/bootstrap-select.min.js"></script>
    <script type="text/javascript" src="../resources/js/main.js"></script>
    <script type="text/javascript" src="../resources/js/index.js"></script>
    <script src="http://code.jquery.com/jquery-1.8.0.min.js"></script>
    <script src="http://echarts.baidu.com/dist/echarts.min.js"></script>
</head>

<body class="flat-blue sidebar-collapse">

<div class="sidebar">
    <div class="menu-control toggle-sidebar">
        <a class="navbar-brand" href="#"><i class="fa fa-bar-chart"></i> 污水智能处理系统</a>
        <i class="fa fa-bars navicon"></i>
    </div>
    <ul class="menu">
        <li class="submenu">
            <a href="/diaisheng/data/default" class="active">
                <div>
                    <i class="menu-icon fa fa-th-large"></i>
                    <span class="menu-title">主页</span>
                </div>
            </a>
        </li>
        <li class="submenu">
            <a href="/diaisheng/data/list">
                <div>
                    <i class="menu-icon fa fa-desktop"></i>
                    <span class="menu-title">实时记录</span>
                </div>
            </a>
        </li>
        <li class="submenu">
            <a href="/diaisheng/data/dataexport">
                <div>
                    <i class="menu-icon fa fa-table"></i>
                    <span class="menu-title">历史记录</span>
                </div>
            </a>
        </li>
        <li class="submenu">
            <a href="/diaisheng/device/location">
                <div>
                    <i class="menu-icon fa fa-map-marker"></i>
                    <span class="menu-title">设备位置</span>
                </div>
            </a>
        </li>

        <li class="submenu">
            <a href="/diaisheng/data/photo" >

                <div>
                    <i class="menu-icon fa fa-camera-retro"></i>
                    <span class="menu-title">实时摄像</span>
                </div>
            </a>

        </li>
        <li class="submenu">
            <a href="/diaisheng/model/list" class="dropdown-toggle">

                <div>
                    <i class="menu-icon fa fa-magic"></i>
                    <span class="menu-title">数据管理</span>
                </div>
            </a>

        </li>

        <li class="submenu">
            <a href="/diaisheng/device/list" class="dropdown-toggle">

                <div>
                    <i class="menu-icon fa fa-slack"></i>
                    <span class="menu-title">设备管理</span>
                </div>
            </a>

        </li>

        <li class="submenu">
            <a href="/diaisheng/varify/exit" class="dropdown-toggle">

                <div>
                    <i class="menu-icon fa fa-power-off"></i>
                    <span class="menu-title">退出系统</span>
                </div>
            </a>

        </li>

    </ul>
</div>




<div class="tlinks">Collect from <a href="http://www.cssmoban.com/"  title="网站模板">网站模板</a></div>
<div class="content-container wrap">
    <nav class="navbar navbar-default">
        <div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="#"><i class="fa fa-bar-chart"></i> 污水智能处理系统</a>
                </div>
                <ul class="nav navbar-nav navbar-right">
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa fa-comments"></i> 0</a>
                        <ul class="dropdown-menu">
                            <li class="dropdown-title-bar">
                                Notification ( 0 )
                            </li>
                            <li class="message">
                                No new notification
                            </li>
                        </ul>
                    </li>
                    <li class="dropdown notification-alert">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-exclamation-circle"></i> 3</a>
                        <ul class="dropdown-menu">
                            <li class="dropdown-title-bar">
                                Notification ( 3 )
                            </li>
                            <li>
                                <ul class="notification-list">
                                    <li>
                                        <a href="#">
                                            <div class="noti-icon noti-alert">
                                                <i class="fa fa-exclamation-circle fa-2x"></i>
                                            </div>
                                            <div class="noti-message">1 new registration</div>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#">
                                            <div class="noti-icon noti-success">
                                                <i class="fa fa-check fa-2x"></i>
                                            </div>
                                            <div class="noti-message">3 new orders</div>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#">
                                            <div class="noti-icon noti-primary">
                                                <i class="fa fa-comments fa-2x"></i>
                                            </div>
                                            <div class="noti-message">2 customers messages</div>
                                        </a>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Emily Hart <span class="caret"></span></a>
                        <ul class="dropdown-menu user-info">
                            <li class="dropdown-title-bar">
                                   <!-- <img src="images/profile.jpg" class="profile-img">-->
                            </li>
                            <li>
                                <div class="navbar-login">
                                    <h4 class="user-name">Emily Hart</h4>
                                    <p>emily_hart@email.com</p>
                                    <div class="btn-group margin-bottom-2x" role="group">
                                        <button type="button" class="btn btn-default"><i class="fa fa-user"></i> Profile</button>
                                        <button type="button" class="btn btn-default"><i class="fa fa-sign-out"></i> Logout</button>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container-fluid -->
    </nav>
    <div class="container-fluid">
        <div class="row">
            <div class="col-xs-12">
                <span class="page-title red"><h2>系统概况</h2></span>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12">

                <ol class="breadcrumb">
                    <li><a href="#">主页</a>
                    </li>
                    <li class="active">系统概况</a>
                    </li>
                </ol>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-3 col-md-6 col-sm-6 col-xs-12">
                <a href="/diaisheng/device/list">
                    <div class="banner-block red">
                        <div class="block-content">
                                <span class="banner-icon fa-stack fa-3x">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-inbox fa-stack-1x fa-inverse"></i>
                                </span>
                            <div class="banner-content">
                                <div class="title" id="device">2</div>
                                <div class="sub-title">设备数</div>
                            </div>
                            <div class="clear-both"></div>
                        </div>

                    </div>
                </a>
            </div>
            <div class="col-lg-3 col-md-6 col-sm-6 col-xs-12">
                <a href="/diaisheng/data/list">
                    <div class="banner-block yellow">
                        <div class="block-content">
                                <span class="fa-stack fa-3x">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                 <i class="fa fa-inbox fa-stack-1x fa-inverse"></i>
                            </span>
                            <div class="banner-content">
                                <div class="title" id="point">17</div>
                                <div class="sub-title">设备数据点数
                                </div>
                            </div>
                            <div class="clear-both"></div>
                        </div>
                    </div>
                </a>
            </div>
            <div class="col-lg-3 col-md-6 col-sm-6 col-xs-12">
                <a href="#">
                    <div class="banner-block green">
                        <div class="block-content">
                                <span class="fa-stack fa-3x">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-tags fa-stack-1x fa-inverse"></i>
                            </span>
                            <div class="banner-content">
                                <div class="title">0</div>
                                <div class="sub-title">报警总数</div>
                            </div>
                            <div class="clear-both"></div>
                        </div>

                    </div>
                </a>
            </div>
            <div class="col-lg-3 col-md-6 col-sm-6 col-xs-12">
                <a href="#">
                    <div class="banner-block blue">
                        <div class="block-content">
                            <span class="fa-stack fa-3x">
                                <i class="fa fa-circle fa-stack-2x"></i>
                               <i class="fa fa-comments fa-stack-1x fa-inverse"></i>
                            </span>
                            <div class="banner-content">
                                <div class="title">0</div>
                                <div class="sub-title">子用户数</div>
                            </div>
                            <div class="clear-both"></div>
                        </div>

                    </div>
                </a>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                <div class="banner-block white">
                    <div class="block-content">
                        <!--<div class="block-title">访问人数</div>-->
                        <div id="main" style="height:300px;width: 700px;"></div>
                        <!--<canvas id="dashboard-order-chart" style="padding:10px 30px 10px 10px;"></canvas>-->
                    </div>
                </div>
            </div>
            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                <div class="banner-block white">
                    <div class="block-content">
                        <!--<div class="block-title">设备在线数</div>-->
                        <div id="main2" style="width: 800px;height:300px;"></div>
                        <div class="row">
                            <div class="col-md-9">
                                <!--<canvas id="dashboard-stat-chart" style="padding:10px 30px 10px 10px;"></canvas>-->
                            </div>

                            <!--<div class="col-md-3">
                                <div id="dashboard-stat-chart-legend" class="pie-legend"></div>
                            </div>-->
                        </div>

                    </div>
                </div>
            </div>
        </div>
   <!--     <div class="row">


        </div>-->
    </div>
</div>

<script type="text/javascript">
    function query(){
        var myCharts = echarts.init(document.getElementById("main"));
        var option = {
            title:{
                text:'COD即时数据',
                subtext:"近一个月"
            },
            tooltip:{
                trigger:'axis'
            },
            legend:{
                data:'COD'
//                data:[]
            },
            grid:{
                left:'3%',
                right:'4%',
                bottom:'3%',
                containLabel:true
            },
            xAxis:{
                type:'category',
                //data:['18:00','18:20','18:40','18:50','19:00','19:05','19:10','19:20','19:30','19:40','19:50'],

                axisLine:{
                    lineStyle:{
//                        color:''
                    }
                },
            },
            yAxis: {
                type: 'value'
            },
            dataZoom: [
                {
                    type: 'slider',
                    xAxisIndex: 0,
                    start: 10,
                    end: 60
                },
                {
                    type: 'inside',
                    xAxisIndex: 0,
                    start: 10,
                    end: 60
                }
//        {
//            type: 'slider',
//            yAxisIndex: 0,
//            start: 30,
//            end: 80
//        },
//        {
//            type: 'inside',
//            yAxisIndex: 0,
//            start: 30,
//            end: 80
//        }
            ],

            series:{
                name:'COD',
                type:'line',
                symbolSize:3,
                color:['green'],
               // data:[1000,200,500,600,800,1100,500,800,600,500,600],
//                data:[],
                //关键点：实线虚线
                smooth:true,
                itemStyle:{
                    normal:{
                        lineStyle:{
                            witdth:2,
                            type:'solid'
                        }
                    }
                }

            }


        }
        myCharts.setOption(option);
         //myCharts.showLoading();
        var name = [];
        var series = [];
        //获取当前时间
        var date = new Date();
        var seperator1 = "-";
        var year = date.getFullYear();
        var month = date.getMonth() + 1;
        var strDate = date.getDate();
        if (month >= 1 && month <= 9) {
            month = "0" + month;
        }
        if (strDate >= 0 && strDate <= 9) {
            strDate = "0" + strDate;
        }
        var minute=date.getMinutes()<=9?"0"+date.getMinutes():date.getMinutes();
        var initEndTime = year + seperator1 + month + seperator1 + strDate+" "+date.getHours()+":"+minute+":"+date.getSeconds();
        var initStartTime;
        if (date.getMonth()==0){//判断是否为1月份
            initStartTime = (year-1) + seperator1 + 12+ seperator1 + strDate+" "+date.getHours()+":"+minute+":"+date.getSeconds();
        }else {
            initStartTime = year + seperator1 + (month-1) + seperator1 + strDate+" "+date.getHours()+":"+minute+":"+date.getSeconds();
        }

        $.ajax({
            type:"post",
            url:"/diaisheng/valueadmin/getdatabetweendate",
            dataType:"json",
            data:{data:'30947',stime:initStartTime,etime:initEndTime},
            success:function(result){
                $.each(result.dataValue,function(key,value){
                    name.push(value.createTime);
                    series.push(value.value);
                });

                myCharts.hideLoading();
                myCharts.setOption({
                    xAxis:{
                        data:name
                    },
                    series:{
                        data:series
                    }
                });

            },
            error: function (errorMsg) {
                //请求失败时执行该函数
                alert("图表请求数据失败!");
                myChart.hideLoading();
            }


        });

    }
    function shebeiPie(jsondata){
        var myChart = echarts.init(document.getElementById('main2'));
        // 指定图表的配置项和数据
        //2.设置Option
        var option={
            tooltip:{
                trigger:'item',
                formatter:"{a}<br/>{b}:{c}({d}%)"
            } ,
            legend:{
                orient:'vertical' ,
                x:'left'   ,
                data:['在线数','不在线数']
            } ,
            series: [
                {
                    name: '设备情况',
                    type: 'pie',
                    radius: ['50%', '70%'],
                    avoidLabelOverlap: false,
                    label: {
                        normal: {
                            show: false,
                            position: 'center'
                        },
                        emphasis: {
                            show: true,
                            textStyle: {
                                fontSize: '30',
                                fontWeight: 'bold'
                            }
                        }
                    }  ,
                    labelLine: {
                        normal: {
                            show: false
                        }
                    },
                    data: [
                        {value: jsondata.online, name: '在线数'},
                        {value: jsondata.offline, name: '不在线数'}

                    ]
                }
            ]
        } ;
        //3.配置百度Echarts的Option
        myChart.setOption(option);
    }
    function pieAjax(){
        $.ajax({
            type:"get",
            url:"/diaisheng/deviceadmin/getonlinedevice",
            dataType:"json",
            success:function(json){
                    shebeiPie(json);
            },
            error: function (errorMsg) {
                //请求失败时执行该函数
                alert("图表请求数据失败!");
                myChart.hideLoading();
            }


        });

    }

    window.onload=function(){
        $.ajax({
            url:"/diaisheng/valueadmin/getdata",
            type: "get",
            dataType: "json",
            success:function(data){
                if(data.success){
                    document.getElementById("device").innerHTML=data.deviceCnt;
                    document.getElementById("point").innerHTML=data.dataPointCnt;
                }else {
                    //alert(data.errMsg);
                }

            }
        });
        pieAjax();
        query();



    }
</script>


</body>

</html>
